{
    "collab_server" : "",
    "contents" : "\n#' @title Number of events tables.\n#' @name eventsTab\n#' @description The function creates tables for each risk with number of events up to given time in groups.\n#' @param time name of a column indicating time of an event or follow-up, must be numeric.\n#' @param risk name of a column indicating type of event, can be numeric or factor/character.\n#' @param group name of a column indicating group variable, can be numeric or factor/character.\n#' @param data data.frame, data.table or matrix containing time, risk and group columns.\n#' @param cens value of 'risk' indicating censored observation (default 0).\n#' @return A grob with n tables, where n is number of risks. Each table contains number of events that have happened in each group up to given time point (the time points correspond to breaks at x-axis of plots with cumulative incidence curves).\n#' @export\n#' @examples eventTab(time = \"time\", risk = \"event\", group = \"gender\", data = LUAD, cens = \"alive\")\n#' @importFrom dplyr filter\n#' @importFrom scales extended_breaks\n#' @importFrom grid textGrob\n\n\neventTab <- function(time, risk, group, data, cens = 0){\n\n    data <- as.data.frame(data)\n    timeCol <- data[, time]\n    groups <- factor(data[, group])\n    risks <- riskVec(data, risk, cens)\n    nrOfRisks <- as.numeric(nrow(risks))\n\n    #extended_breaks\n    fit <- lapply(risks, function(x) {\n        localStatus <- {data[,risk] == x}\n        summary(survfit(Surv(timeCol, localStatus)~groups\n        ))\n    })\n    names(fit) <- risks\n    tmp <- toPlotDf(fit)\n    timePoints <- extended_breaks()(tmp$time)\n\n    uniGroups <- unique(groups)\n    uniGroups <- levels(factor(uniGroups))\n\n    makeRow <- function(whichRisk, whichGroup){\n        tmp <- filter(data, data[, risk] == whichRisk & data[, group] == whichGroup)\n        newRow <- sapply(1:length(timePoints), function(x){\n            length(which(tmp$time <= timePoints[x]))\n        })\n        newRow\n    }\n\n    makeTable <- function(whichRisk){\n        tab <- sapply(uniGroups, function(x) makeRow(whichRisk, x))\n        tab <- as.data.frame(tab)\n        tab <- t(tab)\n        colnames(tab) <- timePoints\n        tab\n    }\n\n\n\n    eventTable <- lapply(risks, function(x) makeTable(x))\n\n    names(eventTable) <- risks\n\n    args <- lapply(eventTable, function(x) arrangeGrob(tableGrob(x, theme = ttheme_minimal())))\n    args$top <- textGrob(\"Number of events\", gp=gpar(fontface=\"bold\"), vjust = 1)\n    args$ncol <- length(risks)\n\n    do.call(grid.arrange, args)\n}\n\n\n\n",
    "created" : 1499806600929.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2203595308",
    "id" : "762E1EA2",
    "lastKnownWriteTime" : 1499809727,
    "last_content_update" : 1499809727398,
    "path" : "~/GitHub/cr17/package/R/eventsTab.R",
    "project_path" : "R/eventsTab.R",
    "properties" : {
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}