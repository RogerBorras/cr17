{
    "collab_server" : "",
    "contents" : "\n#' @title Cumulative Incidences Curves.\n#' @name fitCuminc\n#' @description Fitting cumulative incidence function across different groups and risks.\n#' @param time vector with times of the first event or follow-up, must be numeric.\n#' @param risk vector with type of event, can be numeric or factor/character.\n#' @param group vector with group variable, can be numeric or factor/character.\n#' @param cens value of 'risk' indicating censored observation (if NULL, the first value of 'risk' vector will be taken).\n#' @return list of length [(number of risks)*(number of groups) + 1], containing estimation of cumulative incidences curves for each risk and group. The last element of a group is a data.frame with results of a K-sample test.\n#' @export\n#' @examples fitCuminc(time = LUAD$time, risk = LUAD$event, group = LUAD$gender, cens = \"alive\")\n#' @importFrom dplyr filter\n#' @importFrom cmprsk cuminc\n#' @importFrom survival Surv survfit\n\nfitCuminc <- function(time,\n                     risk,\n                     group,\n                     cens = NULL){\n\n    if(is.null(cens)) cens <- risk[1]\n\n    risks <- riskVec(risk, cens)\n    uniRisks <- 1:length(risks)\n    mapRisks <- cbind(risks, uniRisks)\n    mapRisks <- rbind(mapRisks, c(cens, 0))\n    mapRisks <- as.data.frame(mapRisks)\n    colnames(mapRisks)[1] <- \"risk\"\n\n    groups <- as.data.frame(unique(group))\n    groups <- filter(groups, !is.na(groups))\n    uniGroups <- letters[1:nrow(groups)]\n    mapGroups <- cbind(groups, uniGroups)\n    colnames(mapGroups)[1] <- \"group\"\n\n    dt <- cbind(time, as.character(risk), group)\n    dt <- as.data.frame(dt)\n    colnames(dt) <- c(\"time\", \"risk\", \"group\")\n    dt$time <- as.numeric(as.character(dt$time))\n\n\n    dt <- merge(dt, mapRisks, by = \"risk\")\n    dt <- merge(dt, mapGroups, by = \"group\")\n\n    ci <- cuminc(ftime = dt[, \"time\"],\n                 fstatus = dt[, \"uniRisks\"],\n                 group = dt[, \"uniGroups\"],\n                 cencode = 0)\n\n    aggnames <- names(ci)\n    aggnames <- aggnames[-length(aggnames)]\n\n    tab <- c()\n    for(i in aggnames){\n        tmp <- unlist(strsplit(i, \" \"))\n        tab <- rbind(tab, c(i, tmp))\n    }\n    tab <- as.data.frame(tab)\n\n    colnames(tab) <- c(\"aggnames\", \"uniGroups\", \"uniRisks\")\n\n    tab <- merge(tab, mapRisks, by = \"uniRisks\")\n    tab <- merge(tab, mapGroups, by = \"uniGroups\")\n\n    tab$newname <- paste( tab[, \"risk\"], tab[,\"group\"])\n\n    names(ci)[1:length(ci)-1] <- tab$newname\n\n    tab$risk <- factor(as.character(tab$risk))\n    tab$group <- factor(as.character(tab$group))\n\n    #extended_breaks\n    fit <- lapply(risks, function(x) {\n        localStatus <- {risk == x}\n        summary(survfit(Surv(time, localStatus)~group\n        ))\n    })\n    names(fit) <- risks\n    tmp <- toPlotDf(fit)\n    timePoints <- extended_breaks()(tmp$time)\n\n\n    #adding info about group and risk to each element of group\n    for(i in 1:nrow(tab)){\n        ci[[i]]$group <- tab[i, \"group\"]\n        ci[[i]]$risk <- tab[i, \"risk\"]\n        ci[[i]]$timePoints <- timePoints\n    }\n\n    ci$Tests <- as.data.frame(ci$Tests)\n\n    ci\n}\n\n\n#' @title K-sample Test for Competing Risks.\n#' @name testCuminc\n#' @description Testing differences in cumulative incidences function between groups using K-sample test.\n#' @param ci a result of fitCumin function.\n#' @return data.frame containing p-values of K-sample test for each risk.\n#' @examples fitC <- fitCuminc(time = LUAD$time, risk = LUAD$event, group = LUAD$gender, cens = \"alive\")\n#' testCuminc(fitC)\n#' @export\n\ntestCuminc <- function(ci){\n\n    risks <- levels(ci[[1]]$risk)\n\n    tab <- as.data.frame(ci[[\"Tests\"]])\n    p <- as.data.frame(t(tab$pv))\n    colnames(p) <- risks\n\n\n    tab1 <- vector()\n    for(i in 1:length(risks)){\n        tmp <- p[,which(colnames(p) == risks[i])]\n        tmp <- signif(tmp, digits = 2)\n        tab1 <- as.data.frame(cbind(tab1,tmp))\n    }\n\n\n    colnames(tab1) <- risks\n    rownames(tab1) <- \"K-Sample test\"\n\n    as.data.frame(tab1)\n}\n\n",
    "created" : 1500054644481.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2310116888",
    "id" : "39B3F1D9",
    "lastKnownWriteTime" : 1500054649,
    "last_content_update" : 1500054649348,
    "path" : "~/GitHub/cr17/package/R/fitAndTestCuminc.R",
    "project_path" : "R/fitAndTestCuminc.R",
    "properties" : {
        "docOutlineVisible" : "0"
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}