{
    "collab_server" : "",
    "contents" : "#' @title Number at risk table.\n#' @name riskTab\n#' @description The function creates tables for each risk with number of observation at risk in given time in groups.\n#' @param time vector with times of the first event or follow-up, must be numeric.\n#' @param risk vector with type of event, can be numeric or factor/character.\n#' @param group vector with group variable, can be numeric or factor/character.\n#' @param cens value of 'risk' indicating censored observation (default 0).\n#' @return A grob with n tables, where n is number of risks. Each table contains number of observations at risk in each group in given time points (the time points correspond to breaks at x-axis of plots with survival curves).\n#' @export\n#' @examples riskTab(time = LUAD$time, risk = LUAD$event, group = LUAD$gender, cens = \"alive\")\n#' @importFrom dplyr filter\n#' @importFrom scales extended_breaks\n#' @importFrom grid textGrob\n\n\nriskTab <- function(time, risk, group, cens = 0){\n\n    risks <- riskVec(risk, cens)\n    nrOfRisks <- as.numeric(nrow(risks))\n\n    #extended_breaks\n    fit <- lapply(risks, function(x) {\n        localStatus <- {risk == x}\n        summary(survfit(Surv(time, localStatus)~group\n        ))\n    })\n    names(fit) <- risks\n    tmp <- toPlotDf(fit)\n    timePoints <- extended_breaks()(tmp$time)\n\n\n\n    uniGroups <- unique(group)\n    uniGroups <- levels(factor(uniGroups))\n\n    initialValues <- as.data.frame(sapply(uniGroups, function(x) length(group[group == x])))\n    colnames(initialValues) <- timePoints[1]\n\n    dt <- cbind(time, as.character(risk), group)\n    dt <- as.data.frame(dt)\n    colnames(dt) <- c(\"time\", \"risk\", \"group\")\n    dt$time <- as.numeric(as.character(dt$time))\n\n    dt <- na.omit(dt)\n\n    #countEvents counts how many events is now less in risk set for given risk\n    makeRow <- function(whichRisk, whichGroup){\n        nrOfEvents <- filter(dt, dt$group == whichGroup & dt$risk %in% c(whichRisk, cens))\n        nrOfEvents <- as.data.frame(nrOfEvents)\n        countEvents <- sapply(timePoints[-1], function(x){\n            tmp <- which(nrOfEvents$time < x)\n            length(tmp)\n        })\n        newRow <- c(initialValues[whichGroup,], initialValues[whichGroup,] - countEvents)\n\n        newRow\n    }\n\n\n    makeTab <- function(whichRisk){\n        tab <- sapply(uniGroups, function(x) makeRow(whichRisk, x))\n        tab <- as.data.frame(tab)\n        tab <- t(tab)\n        colnames(tab) <- timePoints\n        tab\n    }\n\n\n    riskTable <- lapply(risks, makeTab)\n    names(riskTable) <- risks\n\n    args <- lapply(riskTable, function(x) arrangeGrob(tableGrob(x, theme = ttheme_minimal())))\n    args$top <- textGrob(\"Number at risk\", gp=gpar(fontface=\"bold\"), vjust = 0.5)\n    args$ncol <- length(risks)\n\n    do.call(grid.arrange, args)\n}\n",
    "created" : 1499846332358.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4146600389",
    "id" : "D455BDF6",
    "lastKnownWriteTime" : 1499850016,
    "last_content_update" : 1499850016436,
    "path" : "~/GitHub/cr17/package/R/riskTab.R",
    "project_path" : "R/riskTab.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}