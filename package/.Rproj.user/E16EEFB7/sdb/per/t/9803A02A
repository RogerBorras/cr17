{
    "collab_server" : "",
    "contents" : "\n#' @title Cumulative Incidences Curves.\n#' @name fitCumul\n#' @description Fitting cumulative incidence function across different groups and risks.\n#' @param time name of a column indicating time of an event or follow-up, must be numeric.\n#' @param risk name of a column indicating type of event, can be numeric or factor/character.\n#' @param group name of a column indicating group variable, can be numeric or factor/character.\n#' @param data data.frame, data.table or matrix containing time, risk and group columns.\n#' @param cens value of 'risk' indicating censored observation (default 0).\n#' @return list of length [(number of risks)*(number of groups) + 1], containing estimation of cumulative incidences curves for each risk and group. The last element of a group is a data.frame with results of a K-sample test.\n#' @export\n#' @examples fitCuminc(time = \"time\", risk = \"event\", group = \"gender\", data = LUAD, cens = \"alive\")\n#' @importFrom dplyr filter\n#' @importFrom cmprsk cuminc\n\nfitCuminc <- function(time,\n                     risk,\n                     group,\n                     data,\n                     cens = 0){\n\n    data <- as.data.frame(data)\n\n    risks <- riskVec(data, risk, cens)\n    uniRisks <- 1:length(risks)\n    mapRisks <- cbind(risks, uniRisks)\n    colnames(mapRisks)[1] <- risk\n\n    groups <- as.data.frame(unique(data[, group]))\n    groups <- filter(groups, !is.na(groups))\n    uniGroups <- letters[1:nrow(groups)]\n    mapGroups <- cbind(groups, uniGroups)\n    colnames(mapGroups)[1] <- group\n\n    data <- merge(data, mapRisks, by = risk)\n    data <- merge(data, mapGroups, by = group)\n\n    ci <- cuminc(ftime = data[, time],\n                 fstatus = data[, \"uniRisks\"],\n                 group = data[, \"uniGroups\"],\n                 cencode = cens)\n\n    aggnames <- names(ci)\n    aggnames <- aggnames[-length(aggnames)]\n\n    tab <- vector()\n    for(i in aggnames){\n        tmp <- unlist(strsplit(i, \" \"))\n        tab <- rbind(tab, c(i, tmp))\n    }\n    tab <- as.data.frame(tab)\n\n    colnames(tab) <- c(\"aggnames\", \"uniGroups\", \"uniRisks\")\n\n    tab <- merge(tab, mapRisks, by = \"uniRisks\")\n    tab <- merge(tab, mapGroups, by = \"uniGroups\")\n\n    tab$newname <- paste(tab[, risk], tab[,group])\n\n    names(ci)[1:length(ci)-1] <- tab$newname\n\n    ci$Tests <- as.data.frame(ci$Tests)\n\n    ci\n}\n\n\n#' @title K-sample Test for Competing Risks.\n#' @name testCuminc\n#' @description Testing differences in cumulative incidences function between groups using K-sample test.\n#' @param ci a result of fitCumin function.\n#' @return data.frame containing p-values of K-sample test for each risk.\n#' @examples fitC <- fitCuminc(time = \"time\", risk = \"event\", group = \"gender\", data = LUAD, cens = \"alive\")\n#' testCuminc(fitC)\n#' @export\n#' @importFrom dplyr filter\n#' @importFrom cmprsk cuminc\n#' @importFrom gridExtra tableGrob\n\ntestCuminc <- function(ci){\n\n    aggNames <- names(ci)\n    aggNames <- aggNames[-length(ci)]\n\n    riskGroup <- sapply(aggNames, function(x){\n        unlist(strsplit(x, split = \" \"))\n    })\n\n    riskGroup <- as.data.frame(riskGroup)\n    riskGroup <- t(riskGroup)\n    colnames(riskGroup) <- c(\"risk\", \"group\")\n\n    risks <- unique(riskGroup[,\"risk\"])\n    risks <- levels(factor(risks))\n\n    groups <- unique(riskGroup[, \"group\"])\n    groups <- levels(factor(groups))\n\n    tab <- as.data.frame(ci[[length(ci)]])\n    p <- as.data.frame(t(tab$pv))\n    colnames(p) <- risks\n\n\n    tab1 <- vector()\n    for(i in 1:length(risks)){\n        tmp <- p[,which(colnames(p) == risks[i])]\n        tmp <- round(tmp, digits = 4)\n        tab1 <- as.data.frame(cbind(tab1,tmp))\n    }\n\n\n    colnames(tab1) <- risks\n    rownames(tab1) <- \"CompRisks LRT\"\n\n    as.data.frame(tab1)\n}\n\n",
    "created" : 1499695915215.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2152540543",
    "id" : "9803A02A",
    "lastKnownWriteTime" : 1499696073,
    "last_content_update" : 1499696073037,
    "path" : "~/GitHub/cr17/package/R/fitAndTestCuminc.R",
    "project_path" : "R/fitAndTestCuminc.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}